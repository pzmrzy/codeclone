commit 94ee2465ecf26ad3dc75098ad885349ab165498c
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Fri Mar 20 10:32:00 2009 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Fri Mar 20 10:32:00 2009 -0800

C# Port:
* Use a partial method to support custom tree adaptors when desired

[git-p4: depot-paths = "//depot/code/antlrcs/main/": change = 5953]

diff --git a/Antlr3.StringTemplate/Language/ActionParser.cs b/Antlr3.StringTemplate/Language/ActionParser.cs
index f67824f..c6c098d 100644
--- a/Antlr3.StringTemplate/Language/ActionParser.cs
+++ b/Antlr3.StringTemplate/Language/ActionParser.cs
@@ -1,4 +1,4 @@
-// $ANTLR 3.1.2 Language\\Action.g3 2009-03-18 18:14:46
+// $ANTLR 3.1.2 Language\\Action.g3 2009-03-20 13:31:28

// The variable 'variable' is assigned but its value is never used.
#pragma warning disable 219
@@ -109,9 +109,14 @@ public partial class ActionParser : Parser
public ActionParser( ITokenStream input, RecognizerSharedState state )
: base( input, state )
{
+		InitializeTreeAdaptor();
+		if ( TreeAdaptor == null )
+			TreeAdaptor = new CommonTreeAdaptor();
}

-	protected ITreeAdaptor adaptor = new CommonTreeAdaptor();
+	// Implement this function in your helper file to use a custom tree adaptor
+	partial void InitializeTreeAdaptor();
+	ITreeAdaptor adaptor;

public ITreeAdaptor TreeAdaptor
{
diff --git a/Antlr3.StringTemplate/Language/ActionParserHelper.cs b/Antlr3.StringTemplate/Language/ActionParserHelper.cs
index 42a4e98..6478cd6 100644
--- a/Antlr3.StringTemplate/Language/ActionParserHelper.cs
+++ b/Antlr3.StringTemplate/Language/ActionParserHelper.cs
@@ -48,10 +48,9 @@ namespace Antlr3.ST.Language
this.self = self;
}

-        protected override void Initialize()
+        partial void InitializeTreeAdaptor()
{
TreeAdaptor = new StringTemplateTreeAdaptor();
-            base.Initialize();
}

public override void ReportError( RecognitionException e )
diff --git a/Antlr3/Grammars/ANTLRParser.cs b/Antlr3/Grammars/ANTLRParser.cs
index b6b991f..28dab1f 100644
--- a/Antlr3/Grammars/ANTLRParser.cs
+++ b/Antlr3/Grammars/ANTLRParser.cs
@@ -1,4 +1,4 @@
-// $ANTLR 3.1.2 Grammars\\ANTLR.g3 2009-03-16 19:03:26
+// $ANTLR 3.1.2 Grammars\\ANTLR.g3 2009-03-20 13:30:48

// The variable 'variable' is assigned but its value is never used.
#pragma warning disable 219
@@ -188,9 +188,14 @@ public partial class ANTLRParser : Parser
public ANTLRParser( ITokenStream input, RecognizerSharedState state )
: base( input, state )
{
+		InitializeTreeAdaptor();
+		if ( TreeAdaptor == null )
+			TreeAdaptor = new CommonTreeAdaptor();
}

-	protected ITreeAdaptor adaptor = new CommonTreeAdaptor();
+	// Implement this function in your helper file to use a custom tree adaptor
+	partial void InitializeTreeAdaptor();
+	ITreeAdaptor adaptor;

public ITreeAdaptor TreeAdaptor
{
diff --git a/Antlr3/Grammars/ANTLRParserHelper.cs b/Antlr3/Grammars/ANTLRParserHelper.cs
index 820c344..b2e29ee 100644
--- a/Antlr3/Grammars/ANTLRParserHelper.cs
+++ b/Antlr3/Grammars/ANTLRParserHelper.cs
@@ -208,10 +208,9 @@ namespace Antlr3.Grammars
return input.LT( k );
}

-        protected override void Initialize()
+        partial void InitializeTreeAdaptor()
{
TreeAdaptor = new grammar_Adaptor( this );
-            base.Initialize();
}

protected virtual GrammarAST setToBlockWithSet( GrammarAST b )
diff --git a/bin/Bootstrap/Codegen/Templates/CSharp3/AST.stg b/bin/Bootstrap/Codegen/Templates/CSharp3/AST.stg
index 4e731de..340b1ae 100644
--- a/bin/Bootstrap/Codegen/Templates/CSharp3/AST.stg
+++ b/bin/Bootstrap/Codegen/Templates/CSharp3/AST.stg
@@ -44,9 +44,18 @@ using RewriteRuleITokenStream = Antlr.Runtime.Tree.RewriteRuleTokenStream;<\n>
<parserMembers()>
>>

+parserCtorBody() ::= <<
+<super.parserCtorBody()>
+InitializeTreeAdaptor();
+if ( TreeAdaptor == null )
+	TreeAdaptor = new CommonTreeAdaptor();
+>>
+
/** Add an adaptor property that knows how to build trees */
parserMembers() ::= <<
-protected ITreeAdaptor adaptor = new CommonTreeAdaptor();<\n>
+// Implement this function in your helper file to use a custom tree adaptor
+partial void InitializeTreeAdaptor();
+ITreeAdaptor adaptor;<\n>
public ITreeAdaptor TreeAdaptor
{
get

