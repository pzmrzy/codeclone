commit 4e787753b97e3acbce0f0ebfdd011dc902f87e29
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Tue Aug 4 13:10:41 2009 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Tue Aug 4 13:10:41 2009 -0800

C# Port:
* Required fix to match the StringTemplateGroup's ResetNameMaps exposed API
* Add unit test for the DateTime bug

[git-p4: depot-paths = "//depot/code/antlrcs/main/": change = 6169]

diff --git a/Antlr3.Test/BaseTest.cs b/Antlr3.Test/BaseTest.cs
index 63733b8..a787a1a 100644
--- a/Antlr3.Test/BaseTest.cs
+++ b/Antlr3.Test/BaseTest.cs
@@ -97,15 +97,7 @@ namespace AntlrUnitTests
ErrorManager.ResetErrorState();

// force reset of static caches
-            new StringTemplateGroup( "" );
-            try
-            {
-                StringTemplateGroup._nameToGroupMap = new Dictionary<string, StringTemplateGroup>();
-                StringTemplateGroup._nameToInterfaceMap = new Dictionary<string, StringTemplateGroupInterface>();
-            }
-            catch ( FieldAccessException )
-            {
-            }
+            StringTemplateGroup.ResetNameMaps();

StringTemplate.ResetTemplateCounter();
StringTemplate.defaultGroup = new StringTemplateGroup( "defaultGroup", "." );
diff --git a/Antlr3.Test/StringTemplateTests.cs b/Antlr3.Test/StringTemplateTests.cs
index f06fba0..ee30003 100644
--- a/Antlr3.Test/StringTemplateTests.cs
+++ b/Antlr3.Test/StringTemplateTests.cs
@@ -6597,6 +6597,22 @@ namespace AntlrUnitTests
Assert.AreEqual( expecting, st.ToString() );
}

+        #region C# port tests only
+
+        [TestMethod]
+        public void TestDateTimeFormatting()
+        {
+            StringTemplate e = new StringTemplate(
+                    "<p>&copy; 2008- $Today.Year$ . All rights reserved.</p>"
+                );
+            e = e.GetInstanceOf();
+            e.SetAttribute("Today", new DateTime(2009, 8, 4));
+            string expecting = "<p>&copy; 2008- 2009 . All rights reserved.</p>";
+            Assert.AreEqual(expecting, e.ToString());
+        }
+
+        #endregion
+
public static void WriteFile( string dir, string fileName, string content )
{
try

