commit 8b2c27b487fadb3cd73dd116d35a6ef56f31ea97
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Sat Nov 20 22:17:09 2010 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Sat Nov 20 22:17:09 2010 -0800

(C# 3) Merge CL6891

[git-p4: depot-paths = "//depot/code/antlrcs/main/": change = 7079]

diff --git a/Antlr3/Grammars/CodeGenTreeWalker.g3 b/Antlr3/Grammars/CodeGenTreeWalker.g3
index 68157c4..77a6b13 100644
--- a/Antlr3/Grammars/CodeGenTreeWalker.g3
+++ b/Antlr3/Grammars/CodeGenTreeWalker.g3
@@ -918,18 +918,21 @@ atom[GrammarAST scope, GrammarAST label, GrammarAST astSuffix]

|	s=STRING_LITERAL
{
+			int i = ((TokenWithIndex)$s.Token).TokenIndex;
if ( grammar.type==GrammarType.Lexer )
{
$code = templates.GetInstanceOf("lexerStringRef");
$code.SetAttribute("string",
generator.target.GetTargetStringLiteralFromANTLRStringLiteral(generator,$s.text));
+				$code.SetAttribute("elementIndex", i);
if ( label!=null )
{
$code.SetAttribute("label", labelText);
}
}
else
-			{ // else it's a token type reference
+			{
+				// else it's a token type reference
$code = GetTokenElementST("tokenRef", "string_literal", $s, astSuffix, labelText);
string tokenLabel =
generator.GetTokenTypeAsTargetLabel(grammar.GetTokenType($s.text));
@@ -938,7 +941,6 @@ atom[GrammarAST scope, GrammarAST label, GrammarAST astSuffix]
{
$code.SetAttribute("hetero",$s.terminalOptions[Grammar.defaultTokenOption]);
}
-				int i = ((TokenWithIndex)$s.Token).TokenIndex;
$code.SetAttribute("elementIndex", i);
generator.GenerateLocalFollow($s,tokenLabel,currentRuleName,i);
}

