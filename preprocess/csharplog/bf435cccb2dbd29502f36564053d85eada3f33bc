commit bf435cccb2dbd29502f36564053d85eada3f33bc
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Fri Jul 29 18:18:57 2011 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Fri Jul 29 18:18:57 2011 -0800

(C# 3) Fix enumeration issue in ST3 (bug introduced in CL8380)
Fix issue with parsing aggregate specs (bug introduced in CL8380)

[git-p4: depot-paths = "//depot/code/antlrcs/main/": change = 8941]

diff --git a/Antlr3.StringTemplate/Language/Cat.cs b/Antlr3.StringTemplate/Language/Cat.cs
index c62c93b..6fab703 100644
--- a/Antlr3.StringTemplate/Language/Cat.cs
+++ b/Antlr3.StringTemplate/Language/Cat.cs
@@ -55,10 +55,16 @@ namespace Antlr3.ST.Language
else if ( item is IEnumerable )
return ( (IEnumerable)item ).Cast<object>();
else if ( item is IEnumerator )
-                    return Enumerable.Repeat( item, 1 );
+                    return Enumerate((IEnumerator)item);
else
return Enumerable.Repeat( item, 1 );
} );
}
+
+        private static IEnumerable<object> Enumerate(IEnumerator enumerator)
+        {
+            while (enumerator.MoveNext())
+                yield return enumerator.Current;
+        }
}
}
diff --git a/Antlr3.StringTemplate/StringTemplate.cs b/Antlr3.StringTemplate/StringTemplate.cs
index 2cf8001..db4a08d 100644
--- a/Antlr3.StringTemplate/StringTemplate.cs
+++ b/Antlr3.StringTemplate/StringTemplate.cs
@@ -871,12 +871,12 @@ namespace Antlr3.ST
aggrSpec );
}

-            string aggrName = aggrSpec.Substring( 0, dot );
-            string propString = aggrSpec.Substring( dot + 1 );
+            string aggrName = aggrSpec.Substring( 0, dot ).Trim();
+            string propString = aggrSpec.Substring( dot + 1 ).Trim();
if (!propString.StartsWith("{") || !propString.EndsWith("}"))
throw new ArgumentException("invalid aggregate attribute format", "aggrSpec");

-            properties.AddRange(propString.Substring(1, propString.Length - 2).Split(','));
+            properties.AddRange(propString.Substring(1, propString.Length - 2).Split(',').Select(i => i.Trim()));
return aggrName;
}


