commit 9253bbec2b24fb202dfd8410090b2f6a41d82ecf
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Wed Jun 29 19:30:32 2011 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Wed Jun 29 19:30:32 2011 -0800

(C# 3) Update DOTGenerator to use ST4

[git-p4: depot-paths = "//depot/code/antlrcs/main/": change = 8802]

diff --git a/Antlr3/Antlr3.csproj b/Antlr3/Antlr3.csproj
index 4ec51c3..42f3daa 100644
--- a/Antlr3/Antlr3.csproj
+++ b/Antlr3/Antlr3.csproj
@@ -453,36 +453,8 @@
<Link>Tool\Templates\messages\languages\en.stg</Link>
<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
</EmbeddedResource>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\action-edge.st">
-      <Link>Tool\Templates\dot\action-edge.st</Link>
-      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
-    </Content>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\decision-rank.st">
-      <Link>Tool\Templates\dot\decision-rank.st</Link>
-      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
-    </Content>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\dfa.st">
-      <Link>Tool\Templates\dot\dfa.st</Link>
-      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
-    </Content>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\edge.st">
-      <Link>Tool\Templates\dot\edge.st</Link>
-      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
-    </Content>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\epsilon-edge.st">
-      <Link>Tool\Templates\dot\epsilon-edge.st</Link>
-      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
-    </Content>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\nfa.st">
-      <Link>Tool\Templates\dot\nfa.st</Link>
-      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
-    </Content>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\state.st">
-      <Link>Tool\Templates\dot\state.st</Link>
-      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
-    </Content>
-    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\stopstate.st">
-      <Link>Tool\Templates\dot\stopstate.st</Link>
+    <Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\tool\templates\dot\dot.stg">
+      <Link>Tool\Templates\dot\dot.stg</Link>
<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
</Content>
<Content Include="..\..\..\antlr\antlr3-main\tool\src\main\resources\org\antlr\codegen\templates\Ruby\AST.stg">
diff --git a/Antlr3/Tool/DOTGenerator.cs b/Antlr3/Tool/DOTGenerator.cs
index 94ab964..85a9906 100644
--- a/Antlr3/Tool/DOTGenerator.cs
+++ b/Antlr3/Tool/DOTGenerator.cs
@@ -42,6 +42,7 @@ namespace Antlr3.Tool
using Path = System.IO.Path;
using StringBuffer = System.Text.StringBuilder;
using StringTemplate = Antlr4.StringTemplate.Template;
+    using TemplateGroupFile = Antlr4.StringTemplate.TemplateGroupFile;
using TemplateGroupDirectory = Antlr4.StringTemplate.TemplateGroupDirectory;
using TemplateGroup = Antlr4.StringTemplate.TemplateGroup;

@@ -112,12 +113,10 @@ namespace Antlr3.Tool

#endregion

-        public static TemplateGroup GetTemplates()
+        public TemplateGroup GetTemplates()
{
if (_stlib == null)
-            {
-                _stlib = new TemplateGroupDirectory(Path.Combine(Path.Combine(Path.Combine(AntlrTool.ToolPathRoot, "Tool"), "Templates"), "dot"));
-            }
+                _stlib = new TemplateGroupFile(Path.Combine(dfaTemplateDirectoryName, "dot.stg"));

return _stlib;
}
@@ -152,7 +151,7 @@ namespace Antlr3.Tool
WalkRuleNFACreatingDOT( dot, startState );
}
dot.SetAttribute( "rankdir", rankdir );
-            return dot.ToString();
+            return dot.Render();
}

#if false
@@ -168,7 +167,7 @@ namespace Antlr3.Tool
markedStates = new HashSet<object>();
dot.SetAttribute( "startState", startState.stateNumber );
walkRuleNFACreatingDOT( dot, startState );
-            return dot.ToString();
+            return dot.Render();
}
#endif

@@ -264,7 +263,7 @@ namespace Antlr3.Tool
GrammarAST n = ( (NFAState)s ).associatedASTNode;
if ( n != null && n.Type != ANTLRParser.EOB )
{
-                    StringTemplate rankST = GetTemplates().GetInstanceOf( "decision-rank" );
+                    StringTemplate rankST = GetTemplates().GetInstanceOf( "decision_rank" );
NFAState alt = (NFAState)s;
while ( alt != null )
{
@@ -309,11 +308,11 @@ namespace Antlr3.Tool
}
if ( edge.IsAction )
{
-                    edgeST = GetTemplates().GetInstanceOf( "action-edge" );
+                    edgeST = GetTemplates().GetInstanceOf( "action_edge" );
}
else if ( edge.IsEpsilon )
{
-                    edgeST = GetTemplates().GetInstanceOf( "epsilon-edge" );
+                    edgeST = GetTemplates().GetInstanceOf( "epsilon_edge" );
}
else
{
@@ -394,7 +393,7 @@ namespace Antlr3.Tool
string predsStr = "";
predsStr = "&&{" +
preds.GenExpr( grammar.generator,
-                                      grammar.generator.Templates, null ).ToString()
+                                      grammar.generator.Templates, null ).Render()
+ "}?";
label += predsStr;
}

