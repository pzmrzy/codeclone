commit 0ee386e4b0bf71adf56a2f6afb1501a8b2aec064
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Sun Apr 10 18:05:45 2011 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Sun Apr 10 18:05:45 2011 -0800

(C# 3) Merge 8145: Pass through updates

[git-p4: depot-paths = "//depot/code/antlrcs/main/": change = 8158]

diff --git a/Antlr4.StringTemplate/Interpreter.cs b/Antlr4.StringTemplate/Interpreter.cs
index 15fbc8b..e35e7ab 100644
--- a/Antlr4.StringTemplate/Interpreter.cs
+++ b/Antlr4.StringTemplate/Interpreter.cs
@@ -615,23 +615,29 @@ namespace Antlr4.StringTemplate
if (!attrs.ContainsKey(arg.Name))
{
//System.out.println("arg "+arg.name+" missing");
-
-                    // We only pass through nonempty values. Further, it makes no sense to set
-                    // values for parameter x if x has no definition above. That is the same as
-                    // having no value.  If we did set to null, we'd mess up
-                    // any default argument (which is set later).
try
{
object o = GetAttribute(frame, arg.Name);
-                        if (o != Template.EmptyAttribute)
+                        // If the attribute exists but there is no value and
+                        // the formal argument has no default value, make it null.
+                        if (o == Template.EmptyAttribute && arg.DefaultValueToken == null)
+                        {
+                            attrs[arg.Name] = null;
+                        }
+                        // Else, the attribute has an existing value, set arg.
+                        else if (o != Template.EmptyAttribute)
{
-                            //System.out.println("setting to "+o);
attrs[arg.Name] = o;
}
}
catch (AttributeNotFoundException)
{
-                        // if no such attribute exists for arg.name, don't set parameter
+                        // if no such attribute exists for arg.name, set parameter
+                        // if no default value
+                        if (arg.DefaultValueToken == null)
+                        {
+                            attrs[arg.Name] = null;
+                        }
}
}
}

