commit 5348c9b594f3a74d3cd81610fc40bec45b19994c
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Fri Apr 10 12:25:39 2009 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Fri Apr 10 12:25:39 2009 -0800

C# Port:
* Updated bootstrap binaries

[git-p4: depot-paths = "//depot/code/antlrcs/main/": change = 6024]

diff --git a/bin/Bootstrap/Antlr3.Runtime.Debug.dll b/bin/Bootstrap/Antlr3.Runtime.Debug.dll
index d657c1a..e2fe9f2 100644
Binary files a/bin/Bootstrap/Antlr3.Runtime.Debug.dll and b/bin/Bootstrap/Antlr3.Runtime.Debug.dll differ
diff --git a/bin/Bootstrap/Antlr3.Runtime.Debug.pdb b/bin/Bootstrap/Antlr3.Runtime.Debug.pdb
index e2dca02..5945afb 100644
Binary files a/bin/Bootstrap/Antlr3.Runtime.Debug.pdb and b/bin/Bootstrap/Antlr3.Runtime.Debug.pdb differ
diff --git a/bin/Bootstrap/Antlr3.Runtime.dll b/bin/Bootstrap/Antlr3.Runtime.dll
index 1430299..8988f68 100644
Binary files a/bin/Bootstrap/Antlr3.Runtime.dll and b/bin/Bootstrap/Antlr3.Runtime.dll differ
diff --git a/bin/Bootstrap/Antlr3.Runtime.pdb b/bin/Bootstrap/Antlr3.Runtime.pdb
index a92a670..64fe7fb 100644
Binary files a/bin/Bootstrap/Antlr3.Runtime.pdb and b/bin/Bootstrap/Antlr3.Runtime.pdb differ
diff --git a/bin/Bootstrap/Antlr3.StringTemplate.dll b/bin/Bootstrap/Antlr3.StringTemplate.dll
index 7d7af25..8125a9e 100644
Binary files a/bin/Bootstrap/Antlr3.StringTemplate.dll and b/bin/Bootstrap/Antlr3.StringTemplate.dll differ
diff --git a/bin/Bootstrap/Antlr3.StringTemplate.pdb b/bin/Bootstrap/Antlr3.StringTemplate.pdb
index 989e407..3382ab6 100644
Binary files a/bin/Bootstrap/Antlr3.StringTemplate.pdb and b/bin/Bootstrap/Antlr3.StringTemplate.pdb differ
diff --git a/bin/Bootstrap/Antlr3.exe b/bin/Bootstrap/Antlr3.exe
index 8b897e9..4849e19 100755
Binary files a/bin/Bootstrap/Antlr3.exe and b/bin/Bootstrap/Antlr3.exe differ
diff --git a/bin/Bootstrap/Antlr3.pdb b/bin/Bootstrap/Antlr3.pdb
index e35069d..cfe6d35 100644
Binary files a/bin/Bootstrap/Antlr3.pdb and b/bin/Bootstrap/Antlr3.pdb differ
diff --git a/bin/Bootstrap/Codegen/Templates/CSharp3/CSharp3.stg b/bin/Bootstrap/Codegen/Templates/CSharp3/CSharp3.stg
index d37a5b6..7b520ad 100644
--- a/bin/Bootstrap/Codegen/Templates/CSharp3/CSharp3.stg
+++ b/bin/Bootstrap/Codegen/Templates/CSharp3/CSharp3.stg
@@ -131,7 +131,7 @@ public partial class <grammar.recognizerName> : <@superClassName><superClass><@e
<endif>
<rules; separator="\n\n">

-	<synpreds:{p | <lexerSynpred(p)>}>
+	<insertLexerSynpreds(synpreds)>

#region DFA
<cyclicDFAs:{dfa | DFA<dfa.decisionNumber> dfa<dfa.decisionNumber>;}; separator="\n">
@@ -275,11 +275,7 @@ public <grammar.recognizerName>( <inputStreamType> input, RecognizerSharedState
#endregion Delegated rules<\n>
<endif>

-<if(synpreds)>
-	#region Synpreds
-	<synpreds:{p | <synpred(p)>}>
-	#endregion Synpreds<\n>
-<endif>
+	<insertSynpreds(synpreds)>

<if(cyclicDFAs)>
#region DFA
@@ -364,15 +360,21 @@ public <!final !>void <ruleName>_fragment(<ruleDescriptor.parameterScope:paramet
// $ANTLR end <ruleName>
>>

-synpred(name) ::= <<
-public <!final !>bool <name>()
+insertLexerSynpreds(synpreds) ::= <<
+<insertSynpreds(synpreds)>
+>>
+
+insertSynpreds(synpreds) ::= <<
+<if(synpreds)>
+#region Synpreds
+bool EvaluatePredicate( System.Action fragment )
{
state.backtracking++;
<@start()>
int start = input.Mark();
try
{
-		<name>_fragment(); // can never throw exception
+		fragment();
}
catch ( RecognitionException re )
{
@@ -384,11 +386,9 @@ public <!final !>bool <name>()
state.backtracking--;
state.failed=false;
return success;
-}<\n>
->>
-
-lexerSynpred(name) ::= <<
-<synpred(name)>
+}
+#endregion Synpreds<\n>
+<endif>
>>

ruleMemoization(name) ::= <<
@@ -1217,7 +1217,7 @@ notPredicate(pred) ::= "!(<evalPredicate(...)>)"

evalPredicate(pred,description) ::= "(<pred>)"

-evalSynPredicate(pred,description) ::= "<pred>()"
+evalSynPredicate(pred,description) ::= "EvaluatePredicate(<pred>_fragment)"

lookaheadTest(atom,k,atomAsInt) ::= "LA<decisionNumber>_<stateNumber>==<atom>"

diff --git a/bin/Bootstrap/Codegen/Templates/CSharp3/Dbg.stg b/bin/Bootstrap/Codegen/Templates/CSharp3/Dbg.stg
index 69219e0..00249f4 100644
--- a/bin/Bootstrap/Codegen/Templates/CSharp3/Dbg.stg
+++ b/bin/Bootstrap/Codegen/Templates/CSharp3/Dbg.stg
@@ -190,9 +190,9 @@ finally
}<\n>
>>

-@synpred.start() ::= "dbg.BeginBacktrack( state.backtracking );"
+@insertSynpreds.start() ::= "dbg.BeginBacktrack( state.backtracking );"

-@synpred.stop() ::= "dbg.EndBacktrack( state.backtracking, success );"
+@insertSynpreds.stop() ::= "dbg.EndBacktrack( state.backtracking, success );"

// Common debug event triggers used by region overrides below

diff --git a/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.dll b/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.dll
index 1078ede..3407cb7 100644
Binary files a/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.dll and b/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.dll differ
diff --git a/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.pdb b/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.pdb
index 3569130..c86b30d 100644
Binary files a/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.pdb and b/bin/Bootstrap/Targets/Antlr3.Targets.CSharp3.pdb differ

