commit ea770341cd0f543a58e4a08460fcf477a0573fef
Author:     parrt <parrt@antlr.org>
AuthorDate: Tue Jul 5 12:40:24 2011 -0800
Commit:     parrt <parrt@antlr.org>
CommitDate: Tue Jul 5 12:40:24 2011 -0800

rewrites weren't pulled from syntactic predicates.

[git-p4: depot-paths = "//depot/code/antlr/antlr3-main/": change = 8836]

diff --git a/tool/CHANGES.txt b/tool/CHANGES.txt
index 0f90e62..9f10cec 100644
--- a/tool/CHANGES.txt
+++ b/tool/CHANGES.txt
@@ -10,6 +10,7 @@ CHANGES
July 5, 2011

* Sam fixes rare infinite loop upon error in nextToken().
+* rewrites weren't pulled from syntactic predicates.

June 29, 2011

diff --git a/tool/src/main/antlr3/org/antlr/grammar/v3/CodeGenTreeWalker.g b/tool/src/main/antlr3/org/antlr/grammar/v3/CodeGenTreeWalker.g
index 9edda79..853a629 100644
--- a/tool/src/main/antlr3/org/antlr/grammar/v3/CodeGenTreeWalker.g
+++ b/tool/src/main/antlr3/org/antlr/grammar/v3/CodeGenTreeWalker.g
@@ -138,8 +138,11 @@ protected final ST getRuleElementST( String name,
GrammarAST elementAST,
GrammarAST ast_suffix,
String label ) {
-    String suffix = getSTSuffix( elementAST, ast_suffix, label );
-    name += suffix;
+	Rule r = grammar.getRule( currentRuleName );
+	String suffix = getSTSuffix( elementAST, ast_suffix, label );
+	if ( !r.isSynPred ) {
+		name += suffix;
+	}
// if we're building trees and there is no label, gen a label
// unless we're in a synpred rule.
Rule r = grammar.getRule( currentRuleName );
diff --git a/tool/src/main/java/org/antlr/tool/GrammarAST.java b/tool/src/main/java/org/antlr/tool/GrammarAST.java
index d6d47da..3d36cc8 100644
--- a/tool/src/main/java/org/antlr/tool/GrammarAST.java
+++ b/tool/src/main/java/org/antlr/tool/GrammarAST.java
@@ -490,7 +490,7 @@ public class GrammarAST extends CommonTree {
for (int i = 0; i < t.getChildCount(); i++){
GrammarAST child = (GrammarAST)t.getChild(i);
int ttype = child.getType();
-			if (ttype == ANTLRParser.REWRITE || ttype==ANTLRParser.ACTION) {
+			if (ttype == ANTLRParser.REWRITES || ttype == ANTLRParser.REWRITE || ttype==ANTLRParser.ACTION) {
continue;
}


