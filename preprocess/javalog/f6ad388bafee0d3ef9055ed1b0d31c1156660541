commit f6ad388bafee0d3ef9055ed1b0d31c1156660541
Author:     sharwell <sharwell@pixelminegames.com>
AuthorDate: Mon Mar 28 15:16:56 2011 -0800
Commit:     sharwell <sharwell@pixelminegames.com>
CommitDate: Mon Mar 28 15:16:56 2011 -0800

Fix enclosing rule reference as root of rewrite

[git-p4: depot-paths = "//depot/code/antlr/antlr3-main/": change = 7949]

diff --git a/runtime/Java/src/main/java/org/antlr/runtime/tree/RewriteRuleSubtreeStream.java b/runtime/Java/src/main/java/org/antlr/runtime/tree/RewriteRuleSubtreeStream.java
index 33d12c4..5189f21 100644
--- a/runtime/Java/src/main/java/org/antlr/runtime/tree/RewriteRuleSubtreeStream.java
+++ b/runtime/Java/src/main/java/org/antlr/runtime/tree/RewriteRuleSubtreeStream.java
@@ -75,6 +75,8 @@ public class RewriteRuleSubtreeStream extends RewriteRuleElementStream {
}
// test size above then fetch
Object tree = _next();
+		while (adaptor.isNil(tree) && adaptor.getChildCount(tree) == 1)
+			tree = adaptor.getChild(tree, 0);
//System.out.println("_next="+((Tree)tree).toStringTree());
Object el = adaptor.dupNode(tree); // dup just the root (want node here)
return el;

