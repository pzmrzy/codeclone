commit 0d2e79b875a63de5be0a349519e6d8dbe6e39763
Author:     Sam Harwell <sam@tunnelvisionlabs.com>
AuthorDate: Wed Dec 12 15:49:58 2012 -0600
Commit:     Sam Harwell <sam@tunnelvisionlabs.com>
CommitDate: Wed Dec 12 15:49:58 2012 -0600

Fix the DOTGenerator

diff --git a/tool/src/main/java/org/antlr/tool/DOTGenerator.java b/tool/src/main/java/org/antlr/tool/DOTGenerator.java
index e4329af..f0180c4 100644
--- a/tool/src/main/java/org/antlr/tool/DOTGenerator.java
+++ b/tool/src/main/java/org/antlr/tool/DOTGenerator.java
@@ -33,7 +33,7 @@ import org.antlr.grammar.v3.ANTLRParser;
import org.antlr.misc.Utils;
import org.stringtemplate.v4.ST;
import org.stringtemplate.v4.STGroup;
-import org.stringtemplate.v4.STGroupDir;
+import org.stringtemplate.v4.STGroupFile;

import java.util.*;

@@ -44,8 +44,8 @@ public class DOTGenerator {
protected String arrowhead="normal";
protected String rankdir="LR";

-	/** Library of output templates; use <attrname> format */
-    public static STGroup stlib = new STGroupDir("org/antlr/tool/templates/dot/dfa");
+	/** Library of output templates; use {@code <attrname>} format */
+    public static STGroup stlib = new STGroupFile("org/antlr/tool/templates/dot/dot.stg");

/** To prevent infinite recursion when walking state machines, record
*  which states we've visited.  Make a new set every time you start
@@ -86,7 +86,7 @@ public class DOTGenerator {
walkRuleNFACreatingDOT(dot, startState);
}
dot.add("rankdir", rankdir);
-        return dot.toString();
+        return dot.render();
}

/** Return a String containing a DOT description that, when displayed,
@@ -299,7 +299,7 @@ public class DOTGenerator {
String predsStr;
predsStr = "&&{"+
preds.genExpr(grammar.generator,
-								  grammar.generator.getTemplates(), null).toString()
+								  grammar.generator.getTemplates(), null).render()
+"}?";
label += predsStr;
}
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/action-edge.st b/tool/src/main/resources/org/antlr/tool/templates/dot/action-edge.st
deleted file mode 100644
index 1bb8e96..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/action-edge.st
+++ /dev/null
@@ -1 +0,0 @@
-<src> -> <target> [fontsize=11, fontname="Courier", arrowsize=.7, label = "<label>"<if(arrowhead)>, arrowhead = <arrowhead><endif>];
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/decision-rank.st b/tool/src/main/resources/org/antlr/tool/templates/dot/decision-rank.st
deleted file mode 100644
index d5142f6..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/decision-rank.st
+++ /dev/null
@@ -1 +0,0 @@
-{rank=same; rankdir=TB; <states; separator="; ">}
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/dfa.st b/tool/src/main/resources/org/antlr/tool/templates/dot/dfa.st
deleted file mode 100644
index 5b81e70..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/dfa.st
+++ /dev/null
@@ -1,7 +0,0 @@
-digraph NFA {
-<if(rankdir)>rankdir=<rankdir>;<endif>
-<decisionRanks; separator="\n">
-<states; separator="\n">
-<edges; separator="\n">
-}
-
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/dot.stg b/tool/src/main/resources/org/antlr/tool/templates/dot/dot.stg
index 96981dc..efcac2c 100644
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/dot.stg
+++ b/tool/src/main/resources/org/antlr/tool/templates/dot/dot.stg
@@ -48,7 +48,7 @@ rankdir=LR;
}
>>

-decision_rank(states) ::= <<
+decision-rank(states) ::= <<
{rank=same; rankdir=TB; <states; separator="; ">}
>>

@@ -56,11 +56,11 @@ edge(src,target,label,arrowhead) ::= <<
<src> -> <target> [fontsize=11, fontname="Courier", arrowsize=.7, label = "<label>"<if(arrowhead)>, arrowhead = <arrowhead><endif>];
>>

-action_edge(src,target,label,arrowhead) ::= <<
+action-edge(src,target,label,arrowhead) ::= <<
<src> -> <target> [fontsize=11, fontname="Courier", arrowsize=.7, label = "<label>"<if(arrowhead)>, arrowhead = <arrowhead><endif>];
>>

-epsilon_edge(src,target,label,arrowhead) ::= <<
+epsilon-edge(src,target,label,arrowhead) ::= <<
<src> -> <target> [fontname="Times-Italic", label = "e"];
>>

diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/edge.st b/tool/src/main/resources/org/antlr/tool/templates/dot/edge.st
deleted file mode 100644
index 1bb8e96..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/edge.st
+++ /dev/null
@@ -1 +0,0 @@
-<src> -> <target> [fontsize=11, fontname="Courier", arrowsize=.7, label = "<label>"<if(arrowhead)>, arrowhead = <arrowhead><endif>];
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/epsilon-edge.st b/tool/src/main/resources/org/antlr/tool/templates/dot/epsilon-edge.st
deleted file mode 100644
index 2a49b2b..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/epsilon-edge.st
+++ /dev/null
@@ -1 +0,0 @@
-<src> -> <target> [fontname="Times-Italic", label = "e"];
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/nfa.st b/tool/src/main/resources/org/antlr/tool/templates/dot/nfa.st
deleted file mode 100644
index 280ced2..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/nfa.st
+++ /dev/null
@@ -1,6 +0,0 @@
-digraph NFA {
-rankdir=LR;
-<decisionRanks; separator="\n">
-<states; separator="\n">
-<edges; separator="\n">
-}
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/state.st b/tool/src/main/resources/org/antlr/tool/templates/dot/state.st
deleted file mode 100644
index f68e3a8..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/state.st
+++ /dev/null
@@ -1 +0,0 @@
-node [fontsize=11, shape = <if(useBox)>box<else>circle, fixedsize=true, width=.4<endif>]; <name>
diff --git a/tool/src/main/resources/org/antlr/tool/templates/dot/stopstate.st b/tool/src/main/resources/org/antlr/tool/templates/dot/stopstate.st
deleted file mode 100644
index 572d460..0000000
--- a/tool/src/main/resources/org/antlr/tool/templates/dot/stopstate.st
+++ /dev/null
@@ -1 +0,0 @@
-node [fontsize=11, shape = <if(useBox)>polygon,sides=4,peripheries=2<else>doublecircle, fixedsize=true, width=.6<endif>]; <name>

