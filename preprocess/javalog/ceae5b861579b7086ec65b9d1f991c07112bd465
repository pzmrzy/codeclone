commit ceae5b861579b7086ec65b9d1f991c07112bd465
Author:     Sanne Grinovero <sanne@hibernate.org>
AuthorDate: Wed Jul 11 16:48:47 2012 +0100
Commit:     Sanne Grinovero <sanne@hibernate.org>
CommitDate: Wed Jul 11 16:48:47 2012 +0100

Don't fail GUnit test on duplicate EOF endings

diff --git a/gunit/src/main/java/org/antlr/gunit/gUnitExecutor.java b/gunit/src/main/java/org/antlr/gunit/gUnitExecutor.java
index 397307e..e71b0da 100644
--- a/gunit/src/main/java/org/antlr/gunit/gUnitExecutor.java
+++ b/gunit/src/main/java/org/antlr/gunit/gUnitExecutor.java
@@ -634,11 +634,21 @@ public class gUnitExecutor implements ITestSuite {
return testResult;
}

+	/**
+	 * Verify the input has been properly consumed
+	 */
protected void checkForValidInput(CommonTokenStream tokens, PrintStream ps2) {
-		/** Invalid input */
if ( tokens.index() != tokens.size() - 1 ) {
-			// throw new InvalidInputException();
-			ps2.print( "Invalid input" );
+			//At this point we need to check for redundant EOF tokens
+			//which might have been added by the Parser:
+			List<? extends Token> endingTokens = tokens.getTokens(tokens.index(), tokens.size() -1);
+			for (Token endToken : endingTokens) {
+				if (! "<EOF>".equals(endToken.getText())) {
+					//writing to ps2 will mark the test as failed:
+					ps2.print( "Invalid input" );
+					return;
+				}
+			}
}
}


