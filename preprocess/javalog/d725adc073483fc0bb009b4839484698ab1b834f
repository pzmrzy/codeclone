commit d725adc073483fc0bb009b4839484698ab1b834f
Author:     Zannick <jokeserver@gmail.com>
AuthorDate: Wed Aug 8 21:22:01 2012 -0700
Commit:     Zannick <jokeserver@gmail.com>
CommitDate: Wed Aug 8 21:22:01 2012 -0700

Fix handling of syntactic predicate fragments.

(Specifically for python3)
- Don't use the base templates for synpred fragments.
This fixes issue 29.
- Don't handle backtracking stuff in synpred fragments.
This fixes a related issue that arose due to the fix above.

diff --git a/tool/src/main/java/org/antlr/codegen/Python3Target.java b/tool/src/main/java/org/antlr/codegen/Python3Target.java
index f9010a1..42bdc43 100644
--- a/tool/src/main/java/org/antlr/codegen/Python3Target.java
+++ b/tool/src/main/java/org/antlr/codegen/Python3Target.java
@@ -42,6 +42,11 @@ import java.util.ArrayList;
import java.util.List;

public class Python3Target extends Target {
+    @Override
+    public boolean useBaseTemplatesForSynPredFragments() {
+        return false;
+    }
+
/** Target must be able to override the labels used for token types */
@Override
public String getTokenTypeAsTargetLabel(CodeGenerator generator,
diff --git a/tool/src/main/resources/org/antlr/codegen/templates/Python3/ASTParser.stg b/tool/src/main/resources/org/antlr/codegen/templates/Python3/ASTParser.stg
index 355de61..d0ee2be 100644
--- a/tool/src/main/resources/org/antlr/codegen/templates/Python3/ASTParser.stg
+++ b/tool/src/main/resources/org/antlr/codegen/templates/Python3/ASTParser.stg
@@ -39,12 +39,14 @@
*/

finishedBacktracking(block) ::= <<
+<if(!ruleDescriptor.isSynPred)>
<if(backtracking)>
if <actions.(actionScope).synpredgate>:
<block>
<else>
<block>
<endif>
+<endif>
>>

@ruleBody.setErrorReturnValue() ::= <<

